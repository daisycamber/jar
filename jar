# This script is for keeping track of herbal mixes for consumption.
# Written by Jay (Jasper Camber Holton)
# Usage: $ jar (name)
# Options "add (herb) #grams"
# or burn #grams
# e.g $ jar 1 add sage 2 # Add 2g of sage to jar 1
# or  $ jar 1 burn 1 # Burn 1g of sage from jar 1
#!/bin/bash
DATE=`date '+%m-%d-%y'`
FILENAME="/home/jay/Documents/Journal/jar/$1.txt" # Name of herb
JOURNALNAME="/home/jay/Documents/Journal/burn.txt" # Name of journal to log burns to in order to 
keep empirical data tight
if [ -f $FILENAME ]; then
  printf 'Herbs in container '
  echo $FILENAME
else
  printf 'Creating one as no herbalism entry was found for '
  echo $FILENAME
  touch $FILENAME
fi
if [ $# -eq 1 ]; then
  FILENAME="/home/jay/Documents/Journal/jar/$1.txt"
  cat $FILENAME
  FILENAME="/home/jay/Documents/Journal/jar/$1.txt"
  readarray lines < $FILENAME
  TOTAL=0;
  for line in "${lines[@]}" # Calculate total contents weight
  do
    arr=($line)
    t=`echo $TOTAL + ${arr[1]} | bc`
    TOTAL=$t
  done
  printf "Total weight is "
  printf $TOTAL
  echo " grams"
elif [ $# -eq 4 ]; then # Essentially what this spaghetti does is checks which herb we are 
referring to and adds a certain quantity
  FILENAME="/home/jay/Documents/Journal/jar/$1.txt"
  readarray lines < $FILENAME
  COUNTER=0;
  FOUND=0;
  for line in "${lines[@]}"
  do
    arr=($line)
    if [ ${arr[0]} == $3 ]; then
      FOUND=1;
      q=`echo ${arr[1]} + $4 | bc`
      quantity="$q"
      lines[COUNTER]="${arr[0]} $quantity";
    fi
    let "COUNTER += 1"
  done
  > $FILENAME # Remove the file and reprint lines to account for changes
  for line in "${lines[@]}"
  do
    echo $line >> $FILENAME
  done
  if [ $FOUND -eq 0 ]; then # If this herb wasnt found, add it to the file
    printf $3 >> $FILENAME
    printf " " >> $FILENAME
    printf $4 >> $FILENAME
  fi
elif [ $# -eq 3 ]; then # This part of the code lets you remove some of the herb and burn it
  FILENAME="/home/jay/Documents/Journal/jar/$1.txt"
  readarray lines < $FILENAME
  TOTAL=0;
  for line in "${lines[@]}" # Calculate total contents weight
  do
    arr=($line)
    t=`echo $TOTAL + ${arr[1]} | bc`
    TOTAL=$t
  done
  COUNTER=0;
  for line in "${lines[@]}" # Calculate remaining contents wait accounting for $3
  do
    arr=($line)
    x=${arr[1]}
    q=`echo "scale=3 ; $3 / $TOTAL" | bc`
    quantity=$q
    n=`echo "$q * $x" | bc -l` # Quantity removed, save this for future reference w/details 
(science)
    printf $1 >> $JOURNALNAME # Name of jar
    printf " " >> $JOURNALNAME
    printf ${arr[0]} >> $JOURNALNAME # Name of ingredient
    printf " " >> $JOURNALNAME
    echo "$n" >> $JOURNALNAME # Quantity removed
    nw=`echo "${arr[1]} - $n" | bc -l`
    lines[COUNTER]="${arr[0]} $nw";
    let "COUNTER += 1"
  done
  > $FILENAME # Remove the file and reprint lines to account for changes
  for line in "${lines[@]}"
  do
    arr=($line)
    x=${arr[1]}
    q=`echo $x'>'0 | bc -l`
    if [ "$q" -eq 1 ]; then
      echo $line >> $FILENAME
    fi
  done
fi

